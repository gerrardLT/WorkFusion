# å¤šåœºæ™¯AIçŸ¥è¯†é—®ç­”ç³»ç»Ÿ - é¡¹ç›®æ·±åº¦åˆ†ææŠ¥å‘Š

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**åˆ›å»ºæ—¶é—´ï¼š** 2025å¹´1æœˆ
**é¡¹ç›®ç±»å‹ï¼š** ä¼ä¸šçº§RAGæ™ºèƒ½é—®ç­”ç³»ç»Ÿ
**ç›®æ ‡è¯»è€…ï¼š** é¡¹ç›®ç»´æŠ¤è€…ã€æŠ€æœ¯ç®¡ç†è€…ã€æ–°åŠ å…¥å¼€å‘è€…

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è§ˆ](#1-é¡¹ç›®æ¦‚è§ˆ)
2. [æŠ€æœ¯æ¶æ„](#2-æŠ€æœ¯æ¶æ„)
3. [æ ¸å¿ƒæŠ€æœ¯æ ˆ](#3-æ ¸å¿ƒæŠ€æœ¯æ ˆ)
4. [ç³»ç»Ÿæ¨¡å—è¯¦è§£](#4-ç³»ç»Ÿæ¨¡å—è¯¦è§£)
5. [æ•°æ®æ¶æ„](#5-æ•°æ®æ¶æ„)
6. [AIæ ¸å¿ƒèƒ½åŠ›](#6-aiæ ¸å¿ƒèƒ½åŠ›)
7. [å‰ç«¯æ¶æ„](#7-å‰ç«¯æ¶æ„)
8. [åç«¯æ¶æ„](#8-åç«¯æ¶æ„)
9. [éƒ¨ç½²ä¸è¿ç»´](#9-éƒ¨ç½²ä¸è¿ç»´)
10. [å¼€å‘æŒ‡å—](#10-å¼€å‘æŒ‡å—)

---

## 1. é¡¹ç›®æ¦‚è§ˆ

### 1.1 é¡¹ç›®å®šä½

**å¤šåœºæ™¯AIçŸ¥è¯†é—®ç­”ç³»ç»Ÿ**æ˜¯ä¸€ä¸ªåŸºäº Agentic RAG æ¶æ„çš„ä¼ä¸šçº§æ™ºèƒ½é—®ç­”å¹³å°ï¼Œæ”¯æŒå¤šä¸šåŠ¡åœºæ™¯çš„æ–‡æ¡£åˆ†æå’Œæ™ºèƒ½å¯¹è¯ã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**
- ğŸ¯ **å¤šåœºæ™¯æ”¯æŒ**ï¼šæ‹›æŠ•æ ‡ã€ä¼ä¸šç®¡ç†ã€è´¢åŠ¡ã€é‡‡è´­ç­‰å¤šä¸ªä¸šåŠ¡åœºæ™¯
- ğŸ¤– **æ™ºèƒ½é—®ç­”**ï¼šåŸºäº Agentic RAG çš„é«˜ç²¾åº¦æ–‡æ¡£é—®ç­”
- ğŸ“„ **æ–‡æ¡£å¤„ç†**ï¼šæ”¯æŒ PDFã€Word ç­‰å¤šç§æ ¼å¼çš„æ™ºèƒ½è§£æ
- ğŸ” **æ··åˆæ£€ç´¢**ï¼šBM25 + FAISS å‘é‡æ£€ç´¢ + RRF èåˆ
- ğŸš€ **ä¼ä¸šçº§ç‰¹æ€§**ï¼šå¤šç§Ÿæˆ·éš”ç¦»ã€ç”¨æˆ·è®¤è¯ã€æƒé™ç®¡ç†

### 1.2 é¡¹ç›®è§„æ¨¡

```
æ€»ä»£ç è¡Œæ•°ï¼šçº¦ 50,000+ è¡Œ
â”œâ”€â”€ åç«¯ Pythonï¼šçº¦ 25,000 è¡Œ
â”œâ”€â”€ å‰ç«¯ TypeScript/Reactï¼šçº¦ 20,000 è¡Œ
â”œâ”€â”€ AI/ML æ ¸å¿ƒï¼šçº¦ 5,000 è¡Œ
â””â”€â”€ é…ç½®/æ–‡æ¡£ï¼šçº¦ 5,000 è¡Œ

ä¸»è¦æ–‡ä»¶æ•°ï¼š200+ ä¸ª
â”œâ”€â”€ Python æ–‡ä»¶ï¼š80+ ä¸ª
â”œâ”€â”€ TypeScript/React æ–‡ä»¶ï¼š100+ ä¸ª
â”œâ”€â”€ é…ç½®æ–‡ä»¶ï¼š20+ ä¸ª
â””â”€â”€ æ–‡æ¡£æ–‡ä»¶ï¼š30+ ä¸ª
```

### 1.3 æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§åˆ†ç±» | åŠŸèƒ½æè¿° | å®ç°çŠ¶æ€ |
|---------|---------|---------|
| **æ™ºèƒ½é—®ç­”** | åŸºäº Agentic RAG çš„æ–‡æ¡£é—®ç­” | âœ… å·²å®Œæˆ |
| **æ–‡æ¡£å¤„ç†** | PDF/Word è§£æã€åˆ†å—ã€å‘é‡åŒ– | âœ… å·²å®Œæˆ |
| **å¤šåœºæ™¯æ”¯æŒ** | 6 ä¸ªä¸šåŠ¡åœºæ™¯åŠ¨æ€åˆ‡æ¢ | âœ… å·²å®Œæˆ |
| **æ··åˆæ£€ç´¢** | BM25 + FAISS + RRF èåˆ | âœ… å·²å®Œæˆ |
| **æ™ºèƒ½è·¯ç”±** | LLM é©±åŠ¨çš„æ–‡æ¡£ç­›é€‰ | âœ… å·²å®Œæˆ |
| **åˆ†å±‚å¯¼èˆª** | å¤šè½®ç­›é€‰ + Token æ§åˆ¶ | âœ… å·²å®Œæˆ |
| **æ™ºèƒ½ç¼“å­˜** | ç²¾ç¡®ç¼“å­˜ + è¯­ä¹‰ç¼“å­˜ | âœ… å·²å®Œæˆ |
| **ç­”æ¡ˆéªŒè¯** | ä¸‰å±‚éªŒè¯æœºåˆ¶ | âœ… å·²å®Œæˆ |
| **ç”¨æˆ·ç³»ç»Ÿ** | JWT è®¤è¯ + å¤šç§Ÿæˆ·éš”ç¦» | âœ… å·²å®Œæˆ |
| **é¡¹ç›®æ¨è** | æ‹›æŠ•æ ‡é¡¹ç›®æ™ºèƒ½åŒ¹é… | âœ… å·²å®Œæˆ |
| **é£é™©è¯†åˆ«** | æ‹›æ ‡æ–‡ä»¶é£é™©æ£€æµ‹ | âœ… å·²å®Œæˆ |
| **å†…å®¹ç”Ÿæˆ** | AI è‡ªåŠ¨ç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆ | âœ… å·²å®Œæˆ |
| **æ•°æ®çˆ¬å–** | æ‹›æ ‡å¹³å°æ•°æ®é‡‡é›† | âœ… å·²å®Œæˆ |

---

## 2. æŠ€æœ¯æ¶æ„

### 2.1 æ€»ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·å±‚ (User Layer)                        â”‚
â”‚                                                               â”‚
â”‚  Web æµè§ˆå™¨ + ç§»åŠ¨æµè§ˆå™¨ + API å®¢æˆ·ç«¯                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTPS
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                å‰ç«¯å±‚ (Frontend Layer)                        â”‚
â”‚                                                               â”‚
â”‚  Next.js 14 App Router + React 18 + TypeScript               â”‚
â”‚  â”œâ”€â”€ åœºæ™¯é€‰æ‹©å™¨ (ScenarioSelector)                           â”‚
â”‚  â”œâ”€â”€ èŠå¤©ç•Œé¢ (ChatInterface)                                â”‚
â”‚  â”œâ”€â”€ æ–‡æ¡£ä¸Šä¼  (FileUploader)                                 â”‚
â”‚  â”œâ”€â”€ çŸ¥è¯†åº“ç®¡ç† (KnowledgeManager)                           â”‚
â”‚  â””â”€â”€ é¡¹ç›®æ¨è (ProjectRecommendation)                        â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ REST API (JSON)
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API ç½‘å…³å±‚ (API Gateway Layer)                   â”‚
â”‚                                                               â”‚
â”‚  FastAPI + Uvicorn                                            â”‚
â”‚  â”œâ”€â”€ /api/v2/chat/*      é—®ç­”æ¥å£                            â”‚
â”‚  â”œâ”€â”€ /api/v2/upload/*    æ–‡æ¡£ä¸Šä¼                             â”‚
â”‚  â”œâ”€â”€ /api/v2/scenarios/* åœºæ™¯ç®¡ç†                            â”‚
â”‚  â”œâ”€â”€ /api/v2/knowledge/* çŸ¥è¯†åº“                              â”‚
â”‚  â”œâ”€â”€ /api/v2/projects/*  é¡¹ç›®æ¨è                            â”‚
â”‚  â””â”€â”€ /api/v2/auth/*      ç”¨æˆ·è®¤è¯                            â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                       â”‚                  â”‚
      â”‚                       â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡æœåŠ¡å±‚   â”‚    â”‚  AI æ ¸å¿ƒå¼•æ“å±‚   â”‚   â”‚  æ•°æ®æœåŠ¡å±‚     â”‚
â”‚              â”‚    â”‚                 â”‚   â”‚                â”‚
â”‚ ScenarioSvc  â”‚    â”‚ Agentic RAG     â”‚   â”‚ SQLite DB      â”‚
â”‚ DocumentSvc  â”‚    â”‚ â”œâ”€ HybridRet    â”‚   â”‚ FAISS Index    â”‚
â”‚ ChatSvc      â”‚    â”‚ â”œâ”€ RoutingAgent â”‚   â”‚ BM25 Index     â”‚
â”‚ KnowledgeSvc â”‚    â”‚ â”œâ”€ LayeredNav   â”‚   â”‚ File Storage   â”‚
â”‚ ProjectSvc   â”‚    â”‚ â”œâ”€ SmartCache   â”‚   â”‚                â”‚
â”‚ CrawlerSvc   â”‚    â”‚ â””â”€ Verifier     â”‚   â”‚                â”‚
â”‚              â”‚    â”‚                 â”‚   â”‚                â”‚
â”‚ RiskSvc      â”‚    â”‚ ContentGen      â”‚   â”‚                â”‚
â”‚ EvaluationSvcâ”‚    â”‚ RiskDetection   â”‚   â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  å¤–éƒ¨æœåŠ¡å±‚     â”‚
                    â”‚                â”‚
                    â”‚ DashScope API  â”‚
                    â”‚ (é€šä¹‰åƒé—®)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ¶æ„ç‰¹ç‚¹

**âœ… åˆ†å±‚æ¶æ„**
- å‰åç«¯åˆ†ç¦»ï¼ŒèŒè´£æ¸…æ™°
- ä¸šåŠ¡é€»è¾‘ã€AI å¼•æ“ã€æ•°æ®å­˜å‚¨ç‹¬ç«‹
- ä¾¿äºæ‰©å±•å’Œç»´æŠ¤

**âœ… å¤šåœºæ™¯æ”¯æŒ**
- åœºæ™¯é…ç½®åŒ–ç®¡ç†
- åŠ¨æ€åˆ‡æ¢æ— éœ€é‡å¯
- æ•°æ®æŒ‰åœºæ™¯éš”ç¦»

**âœ… å¾®æœåŠ¡åŒ–è®¾è®¡**
- å„æœåŠ¡æ¨¡å—ç‹¬ç«‹
- å¯æŒ‰éœ€æ°´å¹³æ‰©å±•
- æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²

**âœ… ç§Ÿæˆ·éš”ç¦»**
- å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»
- ç”¨æˆ·æƒé™ç®¡ç†
- å®‰å…¨æ€§ä¿éšœ

---

## 3. æ ¸å¿ƒæŠ€æœ¯æ ˆ

### 3.1 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | è¯´æ˜ |
|------|------|------|------|
| **Next.js** | 14.1.0 | React æ¡†æ¶ | App Routerï¼ŒæœåŠ¡ç«¯æ¸²æŸ“ |
| **React** | 18.2.0 | UI åº“ | ç»„ä»¶åŒ–å¼€å‘ |
| **TypeScript** | 5.3.0 | ç±»å‹å®‰å…¨ | ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ |
| **Tailwind CSS** | 3.4.0 | æ ·å¼æ¡†æ¶ | Utility-first CSS |
| **Zustand** | 4.5.0 | çŠ¶æ€ç®¡ç† | è½»é‡çº§çŠ¶æ€ç®¡ç† |
| **Axios** | 1.6.0 | HTTP å®¢æˆ·ç«¯ | API è¯·æ±‚å°è£… |
| **React Markdown** | 9.0.0 | Markdown æ¸²æŸ“ | æ”¯æŒ GFMã€ä»£ç é«˜äº® |
| **Lucide React** | 0.344.0 | å›¾æ ‡åº“ | ä¸°å¯Œçš„å›¾æ ‡ç»„ä»¶ |
| **Framer Motion** | 11.0.0 | åŠ¨ç”»åº“ | æµç•…çš„åŠ¨ç”»æ•ˆæœ |

### 3.2 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | è¯´æ˜ |
|------|------|------|------|
| **Python** | 3.10+ | åç«¯è¯­è¨€ | ä¸»è¦å¼€å‘è¯­è¨€ |
| **FastAPI** | 0.104.0+ | Web æ¡†æ¶ | é«˜æ€§èƒ½å¼‚æ­¥æ¡†æ¶ |
| **Uvicorn** | 0.24.0+ | ASGI æœåŠ¡å™¨ | ç”Ÿäº§çº§æœåŠ¡å™¨ |
| **SQLAlchemy** | 2.0+ | ORM | æ•°æ®åº“æ“ä½œ |
| **SQLite** | 3.x | æ•°æ®åº“ | å¼€å‘å’Œå°è§„æ¨¡éƒ¨ç½² |
| **Pydantic** | 2.5.0+ | æ•°æ®éªŒè¯ | ç±»å‹å®‰å…¨çš„æ•°æ®æ¨¡å‹ |
| **Alembic** | 1.12.0+ | æ•°æ®åº“è¿ç§» | ç‰ˆæœ¬æ§åˆ¶ |
| **PyJWT** | 2.8.0+ | JWT è®¤è¯ | ç”¨æˆ·è®¤è¯ |
| **Scrapy** | 2.11+ | çˆ¬è™«æ¡†æ¶ | æ•°æ®é‡‡é›† |
| **APScheduler** | 3.10+ | å®šæ—¶ä»»åŠ¡ | ä»»åŠ¡è°ƒåº¦ |

### 3.3 AI/ML æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | è¯´æ˜ |
|------|------|------|------|
| **DashScope** | 1.17.0+ | å¤§è¯­è¨€æ¨¡å‹ | é€šä¹‰åƒé—® API |
| **FAISS** | 1.7.4+ | å‘é‡æ•°æ®åº“ | é«˜æ€§èƒ½ç›¸ä¼¼åº¦æœç´¢ |
| **BM25** | 0.2.2+ | å…³é”®è¯æ£€ç´¢ | ç¨€ç–å‘é‡æ£€ç´¢ |
| **MinerU** | 2.5.4+ | PDF è§£æ | é«˜ç²¾åº¦æ–‡æ¡£è§£æ |
| **PyMuPDF** | 1.23.0+ | PDF å¤„ç† | æ–‡æœ¬æå– |
| **Jieba** | 0.42.1+ | ä¸­æ–‡åˆ†è¯ | BM25 åˆ†è¯ |
| **Tiktoken** | 0.5.0+ | Token è®¡æ•° | OpenAI tokenizer |
| **Tenacity** | 8.2.0+ | é‡è¯•æœºåˆ¶ | API è°ƒç”¨é‡è¯• |

---

## 4. ç³»ç»Ÿæ¨¡å—è¯¦è§£

### 4.1 æ ¸å¿ƒæ¨¡å—æ¶æ„

```
src/                          # AI æ ¸å¿ƒå¼•æ“
â”œâ”€â”€ pipeline.py               # RAG ä¸»æµç¨‹
â”œâ”€â”€ questions_processing.py   # é—®ç­”å¤„ç†å™¨
â”œâ”€â”€ ingestion.py             # æ–‡æ¡£æ‘„å–
â”œâ”€â”€ pdf_parsing_mineru.py    # PDF è§£æ
â”œâ”€â”€ dashscope_client.py      # DashScope API
â”œâ”€â”€ config.py                # é…ç½®ç®¡ç†
â”‚
â”œâ”€â”€ retrieval/               # æ£€ç´¢æ¨¡å—
â”‚   â”œâ”€â”€ hybrid_retriever.py     # æ··åˆæ£€ç´¢å™¨
â”‚   â”œâ”€â”€ bm25_retriever.py       # BM25 æ£€ç´¢
â”‚   â”œâ”€â”€ vector_retriever.py     # å‘é‡æ£€ç´¢
â”‚   â””â”€â”€ layered_navigator.py    # åˆ†å±‚å¯¼èˆª
â”‚
â”œâ”€â”€ agents/                  # æ™ºèƒ½ Agent
â”‚   â””â”€â”€ routing_agent.py        # è·¯ç”±ä»£ç†
â”‚
â”œâ”€â”€ cache/                   # ç¼“å­˜ç³»ç»Ÿ
â”‚   â””â”€â”€ smart_cache.py          # æ™ºèƒ½ç¼“å­˜
â”‚
â””â”€â”€ verification/            # éªŒè¯ç³»ç»Ÿ
    â””â”€â”€ answer_verifier.py      # ç­”æ¡ˆéªŒè¯å™¨

backend/                     # åç«¯æœåŠ¡
â”œâ”€â”€ api/                     # API è·¯ç”±å±‚
â”‚   â”œâ”€â”€ chat.py                 # é—®ç­”æ¥å£
â”‚   â”œâ”€â”€ upload.py               # æ–‡æ¡£ä¸Šä¼ 
â”‚   â”œâ”€â”€ scenarios.py            # åœºæ™¯ç®¡ç†
â”‚   â”œâ”€â”€ knowledge.py            # çŸ¥è¯†åº“
â”‚   â”œâ”€â”€ company.py              # ä¼ä¸šç®¡ç†
â”‚   â”œâ”€â”€ recommendation.py       # é¡¹ç›®æ¨è
â”‚   â”œâ”€â”€ evaluation.py           # è¯„ä¼°æŠ¥å‘Š
â”‚   â”œâ”€â”€ checklist.py            # ä»»åŠ¡æ¸…å•
â”‚   â”œâ”€â”€ risk.py                 # é£é™©è¯†åˆ«
â”‚   â””â”€â”€ auth.py                 # ç”¨æˆ·è®¤è¯
â”‚
â”œâ”€â”€ services/                # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ scenario_service.py     # åœºæ™¯æœåŠ¡
â”‚   â”œâ”€â”€ document_service.py     # æ–‡æ¡£æœåŠ¡
â”‚   â”œâ”€â”€ knowledge_service.py    # çŸ¥è¯†åº“æœåŠ¡
â”‚   â”œâ”€â”€ company_service.py      # ä¼ä¸šæœåŠ¡
â”‚   â”œâ”€â”€ recommendation_service.py # æ¨èæœåŠ¡
â”‚   â”œâ”€â”€ evaluation_service.py   # è¯„ä¼°æœåŠ¡
â”‚   â”œâ”€â”€ risk_service.py         # é£é™©æœåŠ¡
â”‚   â””â”€â”€ crawler_service.py      # çˆ¬è™«æœåŠ¡
â”‚
â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ scenario.py             # åœºæ™¯æ¨¡å‹
â”‚   â”œâ”€â”€ document.py             # æ–‡æ¡£æ¨¡å‹
â”‚   â”œâ”€â”€ chat.py                 # èŠå¤©æ¨¡å‹
â”‚   â”œâ”€â”€ user.py                 # ç”¨æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ company.py              # ä¼ä¸šæ¨¡å‹
â”‚   â”œâ”€â”€ project.py              # é¡¹ç›®æ¨¡å‹
â”‚   â””â”€â”€ knowledge.py            # çŸ¥è¯†æ¨¡å‹
â”‚
â”œâ”€â”€ crawler/                 # çˆ¬è™«æ¨¡å—
â”‚   â”œâ”€â”€ spiders/                # çˆ¬è™«å®ç°
â”‚   â”œâ”€â”€ pipelines.py            # æ•°æ®ç®¡é“
â”‚   â””â”€â”€ settings.py             # çˆ¬è™«é…ç½®
â”‚
â”œâ”€â”€ middleware/              # ä¸­é—´ä»¶
â”‚   â””â”€â”€ auth_middleware.py      # è®¤è¯ä¸­é—´ä»¶
â”‚
â”œâ”€â”€ database.py              # æ•°æ®åº“è¿æ¥
â””â”€â”€ main_multi_scenario.py   # ä¸»å…¥å£

frontend-next/               # å‰ç«¯åº”ç”¨
â”œâ”€â”€ app/                     # Next.js é¡µé¢
â”‚   â”œâ”€â”€ page.tsx                # é¦–é¡µï¼ˆèŠå¤©ï¼‰
â”‚   â”œâ”€â”€ knowledge/              # çŸ¥è¯†åº“
â”‚   â”œâ”€â”€ company/                # ä¼ä¸šç®¡ç†
â”‚   â”œâ”€â”€ projects/               # é¡¹ç›®æ¨è
â”‚   â”œâ”€â”€ tasks/                  # ä»»åŠ¡æ¸…å•
â”‚   â””â”€â”€ evaluations/            # è¯„ä¼°æŠ¥å‘Š
â”‚
â”œâ”€â”€ components/              # React ç»„ä»¶
â”‚   â”œâ”€â”€ chat/                   # èŠå¤©ç»„ä»¶
â”‚   â”œâ”€â”€ scenario/               # åœºæ™¯ç»„ä»¶
â”‚   â”œâ”€â”€ upload/                 # ä¸Šä¼ ç»„ä»¶
â”‚   â”œâ”€â”€ knowledge/              # çŸ¥è¯†åº“ç»„ä»¶
â”‚   â””â”€â”€ ui/                     # UI åŸºç¡€ç»„ä»¶
â”‚
â”œâ”€â”€ contexts/                # React Context
â”‚   â””â”€â”€ scenario-context.tsx    # åœºæ™¯ä¸Šä¸‹æ–‡
â”‚
â”œâ”€â”€ stores/                  # Zustand çŠ¶æ€
â”‚   â”œâ”€â”€ chat-store.ts           # èŠå¤©çŠ¶æ€
â”‚   â”œâ”€â”€ upload-store.ts         # ä¸Šä¼ çŠ¶æ€
â”‚   â””â”€â”€ settings-store.ts       # è®¾ç½®çŠ¶æ€
â”‚
â”œâ”€â”€ lib/                     # å·¥å…·åº“
â”‚   â”œâ”€â”€ api-v2.ts               # API å®¢æˆ·ç«¯
â”‚   â””â”€â”€ utils.ts                # å·¥å…·å‡½æ•°
â”‚
â””â”€â”€ types/                   # TypeScript ç±»å‹
    â”œâ”€â”€ chat.ts
    â”œâ”€â”€ document.ts
    â””â”€â”€ project.ts
```

### 4.2 æ•°æ®æµå›¾

```
ç”¨æˆ·æé—®æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯éªŒè¯å’Œé¢„å¤„ç†  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ POST /api/v2/chat/ask
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API ç½‘å…³è®¤è¯     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatAPI å¤„ç†      â”‚
â”‚ â”œâ”€ éªŒè¯åœºæ™¯       â”‚
â”‚ â”œâ”€ åˆ›å»º/è·å–ä¼šè¯  â”‚
â”‚ â””â”€ è°ƒç”¨ Pipeline  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pipeline.answer_question â”‚
â”‚ â”œâ”€ æ£€æŸ¥å°±ç»ªçŠ¶æ€          â”‚
â”‚ â””â”€ è°ƒç”¨ QuestionsProcessorâ”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QuestionsProcessor å¤„ç†æµç¨‹  â”‚
â”‚ â”œâ”€ 1. æ£€æŸ¥ç¼“å­˜ (SmartCache) â”‚
â”‚ â”œâ”€ 2. æ··åˆæ£€ç´¢ (HybridRet)  â”‚
â”‚ â”œâ”€ 3. æ™ºèƒ½è·¯ç”± (RoutingAgent)â”‚
â”‚ â”œâ”€ 4. åˆ†å±‚å¯¼èˆª (LayeredNav) â”‚
â”‚ â”œâ”€ 5. LLM ç”Ÿæˆç­”æ¡ˆ          â”‚
â”‚ â”œâ”€ 6. ç­”æ¡ˆéªŒè¯ (Verifier)   â”‚
â”‚ â””â”€ 7. ç¼“å­˜ç»“æœ              â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”å›ç­”æ¡ˆç»™ç”¨æˆ·   â”‚
â”‚  â”œâ”€ ç­”æ¡ˆæ–‡æœ¬      â”‚
â”‚  â”œâ”€ ç½®ä¿¡åº¦        â”‚
â”‚  â”œâ”€ æ¥æºæ–‡æ¡£      â”‚
â”‚  â””â”€ å¤„ç†æ—¶é—´      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æ•°æ®æ¶æ„

### 5.1 æ•°æ®åº“è¡¨ç»“æ„

**æ ¸å¿ƒè¡¨ï¼š**

```sql
-- åœºæ™¯è¡¨
CREATE TABLE scenarios (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    config JSON,
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

-- æ–‡æ¡£è¡¨
CREATE TABLE documents (
    id VARCHAR(50) PRIMARY KEY,
    scenario_id VARCHAR(50),
    title VARCHAR(255),
    file_path VARCHAR(500),
    file_size INTEGER,
    pages INTEGER,
    language VARCHAR(20),
    doc_metadata JSON,
    status VARCHAR(20),
    quality_score DECIMAL(3,2),
    created_at TIMESTAMP,
    processed_at TIMESTAMP,
    FOREIGN KEY (scenario_id) REFERENCES scenarios(id)
);

-- èŠå¤©ä¼šè¯è¡¨
CREATE TABLE chat_sessions (
    id VARCHAR(50) PRIMARY KEY,
    scenario_id VARCHAR(50),
    user_id VARCHAR(50),
    tenant_id VARCHAR(50),
    title VARCHAR(255),
    config JSON,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    FOREIGN KEY (scenario_id) REFERENCES scenarios(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- èŠå¤©æ¶ˆæ¯è¡¨
CREATE TABLE chat_messages (
    id VARCHAR(50) PRIMARY KEY,
    session_id VARCHAR(50),
    role VARCHAR(20),
    content TEXT,
    msg_metadata JSON,
    created_at TIMESTAMP,
    FOREIGN KEY (session_id) REFERENCES chat_sessions(id)
);

-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id VARCHAR(50) PRIMARY KEY,
    username VARCHAR(100) UNIQUE,
    email VARCHAR(255) UNIQUE,
    hashed_password VARCHAR(255),
    tenant_id VARCHAR(50),
    is_active BOOLEAN,
    is_superuser BOOLEAN,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

-- ä¼ä¸šä¿¡æ¯è¡¨
CREATE TABLE companies (
    id VARCHAR(50) PRIMARY KEY,
    tenant_id VARCHAR(50),
    name VARCHAR(255),
    qualifications JSON,
    capabilities JSON,
    target_areas JSON,
    metadata JSON,
    created_at TIMESTAMP
);

-- é¡¹ç›®è¡¨
CREATE TABLE projects (
    id VARCHAR(50) PRIMARY KEY,
    title VARCHAR(255),
    source VARCHAR(100),
    source_url VARCHAR(500),
    amount DECIMAL(15,2),
    location VARCHAR(100),
    industry VARCHAR(50),
    deadline TIMESTAMP,
    content TEXT,
    requirements JSON,
    status VARCHAR(20),
    created_at TIMESTAMP
);

-- çŸ¥è¯†åº“è¡¨
CREATE TABLE knowledge_items (
    id VARCHAR(50) PRIMARY KEY,
    tenant_id VARCHAR(50),
    category VARCHAR(50),
    doc_id VARCHAR(50),
    title VARCHAR(255),
    description TEXT,
    tags JSON,
    expire_date DATE,
    metadata JSON,
    created_at TIMESTAMP,
    FOREIGN KEY (doc_id) REFERENCES documents(id)
);
```

### 5.2 æ–‡ä»¶å­˜å‚¨ç»“æ„

```
data/
â”œâ”€â”€ uploads/                    # ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
â”‚   â””â”€â”€ {scenario_id}/
â”‚       â””â”€â”€ {filename}
â”‚
â”œâ”€â”€ stock_data/
â”‚   â”œâ”€â”€ databases/
â”‚   â”‚   â”œâ”€â”€ stock_rag.db       # SQLite æ•°æ®åº“
â”‚   â”‚   â”œâ”€â”€ vector_dbs/        # FAISS å‘é‡ç´¢å¼•
â”‚   â”‚   â”‚   â””â”€â”€ {tenant_id}/
â”‚   â”‚   â”‚       â””â”€â”€ {scenario_id}/
â”‚   â”‚   â”‚           â””â”€â”€ {file_hash}_vector.faiss
â”‚   â”‚   â””â”€â”€ bm25/              # BM25 ç´¢å¼•
â”‚   â”‚       â””â”€â”€ {tenant_id}/
â”‚   â”‚           â””â”€â”€ {scenario_id}/
â”‚   â”‚               â””â”€â”€ {file_hash}_bm25.pkl
â”‚   â”‚
â”‚   â””â”€â”€ debug_data/
â”‚       â””â”€â”€ parsed_reports/    # è§£æåçš„æ–‡æ¡£
â”‚           â””â”€â”€ {doc_id}_parsed.json
â”‚
â”œâ”€â”€ crawler_logs/              # çˆ¬è™«æ—¥å¿—
â”‚   â””â”€â”€ {date}/
â”‚
â””â”€â”€ cookies/                   # çˆ¬è™« Cookie
```

---

## 6. AI æ ¸å¿ƒèƒ½åŠ›

### 6.1 Agentic RAG å®ç°

**æ ¸å¿ƒç»„ä»¶ï¼š**

1. **æ··åˆæ£€ç´¢å™¨ (HybridRetriever)**
   - BM25 å…³é”®è¯æ£€ç´¢
   - FAISS å‘é‡æ£€ç´¢
   - RRF (Reciprocal Rank Fusion) èåˆ

2. **è·¯ç”±ä»£ç† (RoutingAgent)**
   - LLM é©±åŠ¨çš„æ™ºèƒ½æ–‡æ¡£ç­›é€‰
   - åŠ¨æ€è¯„ä¼°æ–‡æ¡£ç›¸å…³æ€§
   - è¾“å‡ºç»“æ„åŒ–é€‰æ‹©ç»“æœ

3. **åˆ†å±‚å¯¼èˆªå™¨ (LayeredNavigator)**
   - å¤šè½®æ–‡æ¡£ç­›é€‰
   - Token æ•°é‡æ§åˆ¶
   - æ¸è¿›å¼ç²¾ç¡®å®šä½

4. **æ™ºèƒ½ç¼“å­˜ (SmartCache)**
   - ç²¾ç¡®åŒ¹é…ç¼“å­˜
   - è¯­ä¹‰ç›¸ä¼¼ç¼“å­˜
   - LRU æ·˜æ±°ç­–ç•¥

5. **ç­”æ¡ˆéªŒè¯å™¨ (AnswerVerifier)**
   - äº‹å®ä¸€è‡´æ€§æ£€æŸ¥
   - æ¥æºå¯è¿½æº¯æ€§éªŒè¯
   - ç½®ä¿¡åº¦è¯„åˆ†

**å·¥ä½œæµç¨‹ï¼š**

```python
# ç®€åŒ–çš„ Agentic RAG æµç¨‹
def agentic_rag_process(question, scenario_id):
    # 1. æ£€æŸ¥ç¼“å­˜
    cached = smart_cache.get(question)
    if cached:
        return cached

    # 2. æ··åˆæ£€ç´¢ (BM25 + FAISS)
    candidates = hybrid_retriever.retrieve(
        question=question,
        top_k=30,
        use_bm25=True,
        use_vector=True
    )

    # 3. æ™ºèƒ½è·¯ç”±ç­›é€‰
    routed = routing_agent.route_documents(
        chunks=candidates,
        question=question,
        top_k=15
    )

    # 4. åˆ†å±‚å¯¼èˆªç²¾ç¡®å®šä½
    final_chunks = layered_navigator.navigate(
        chunks=routed,
        question=question,
        max_rounds=3,
        target_tokens=2000
    )

    # 5. LLM ç”Ÿæˆç­”æ¡ˆ
    answer = llm.generate(
        question=question,
        context=final_chunks
    )

    # 6. ç­”æ¡ˆéªŒè¯
    verified = answer_verifier.verify(
        answer=answer,
        source_chunks=final_chunks,
        question=question
    )

    # 7. ç¼“å­˜ç»“æœ
    smart_cache.set(question, verified)

    return verified
```

### 6.2 æ–‡æ¡£å¤„ç†æµç¨‹

**PDF è§£æ (MinerU):**
```python
# src/pdf_parsing_mineru.py
class PDFParsingPipeline:
    def parse_pdf(self, pdf_path):
        # 1. ä½¿ç”¨ MinerU è§£æ PDF
        parsed_data = mineru.parse(pdf_path)

        # 2. æå–æ–‡æœ¬ã€è¡¨æ ¼ã€å›¾åƒ
        text = parsed_data.get_text()
        tables = parsed_data.get_tables()
        images = parsed_data.get_images()

        # 3. ç»“æ„åŒ–è¾“å‡º
        return {
            "text_content": text,
            "pages": parsed_data.pages,
            "tables": tables,
            "metadata": {...}
        }
```

**æ–‡æ¡£æ‘„å– (Ingestion):**
```python
# src/ingestion.py
class IngestionPipeline:
    def process_document(self, parsed_doc):
        # 1. æ™ºèƒ½åˆ†å—
        chunks = self.smart_chunking(
            text=parsed_doc['text_content'],
            chunk_size=800,
            overlap=200
        )

        # 2. æ„å»º BM25 ç´¢å¼•
        bm25_index = BM25Okapi(tokenized_chunks)

        # 3. ç”Ÿæˆå‘é‡åµŒå…¥
        embeddings = dashscope_client.get_embeddings(
            texts=chunks,
            model="text-embedding-v3"
        )

        # 4. æ„å»º FAISS ç´¢å¼•
        faiss_index = faiss.IndexFlatIP(dimension)
        faiss_index.add(embeddings)

        # 5. ä¿å­˜ç´¢å¼•æ–‡ä»¶
        self.save_indexes(bm25_index, faiss_index)
```

---

## 7. å‰ç«¯æ¶æ„

### 7.1 ç»„ä»¶å±‚æ¬¡ç»“æ„

```
App (page.tsx)
â”œâ”€â”€ ScenarioProvider (åœºæ™¯ä¸Šä¸‹æ–‡)
â”‚   â””â”€â”€ DynamicThemeProvider (åŠ¨æ€ä¸»é¢˜)
â”‚       â””â”€â”€ HomeContent (ä¸»å†…å®¹)
â”‚           â”œâ”€â”€ TopNavBar (é¡¶éƒ¨å¯¼èˆª)
â”‚           â”‚   â”œâ”€â”€ ScenarioSelector (åœºæ™¯é€‰æ‹©å™¨)
â”‚           â”‚   â”œâ”€â”€ SecondaryNav (äºŒçº§å¯¼èˆª)
â”‚           â”‚   â””â”€â”€ UserMenu (ç”¨æˆ·èœå•)
â”‚           â”‚
â”‚           â”œâ”€â”€ Sidebar (ä¾§è¾¹æ )
â”‚           â”‚   â”œâ”€â”€ SearchBar (æœç´¢æ¡†)
â”‚           â”‚   â”œâ”€â”€ NewChatButton (æ–°å»ºæŒ‰é’®)
â”‚           â”‚   â””â”€â”€ SessionList (ä¼šè¯åˆ—è¡¨)
â”‚           â”‚
â”‚           â””â”€â”€ ChatArea (èŠå¤©åŒºåŸŸ)
â”‚               â”œâ”€â”€ MessageList (æ¶ˆæ¯åˆ—è¡¨)
â”‚               â”‚   â””â”€â”€ MessageBubble (æ¶ˆæ¯æ°”æ³¡)
â”‚               â”‚       â”œâ”€â”€ UserMessage
â”‚               â”‚       â””â”€â”€ AssistantMessage
â”‚               â”‚           â””â”€â”€ ReactMarkdown
â”‚               â”‚
â”‚               â””â”€â”€ InputArea (è¾“å…¥åŒºåŸŸ)
â”‚                   â”œâ”€â”€ FileUpload (æ–‡ä»¶ä¸Šä¼ )
â”‚                   â”œâ”€â”€ TextInput (æ–‡æœ¬è¾“å…¥)
â”‚                   â”œâ”€â”€ PresetQuestions (é¢„è®¾é—®é¢˜)
â”‚                   â””â”€â”€ SendButton (å‘é€æŒ‰é’®)
â”‚
â””â”€â”€ UploadNotifications (ä¸Šä¼ é€šçŸ¥)
```

### 7.2 çŠ¶æ€ç®¡ç†

**Zustand Store:**
```typescript
// stores/chat-store.ts
interface ChatState {
  sessions: ChatSession[];
  currentSessionId: string | null;
  messages: ChatMessage[];
  isLoading: boolean;

  // Actions
  createSession: (scenario_id: string) => Promise<void>;
  sendMessage: (content: string) => Promise<void>;
  loadMessages: (sessionId: string) => Promise<void>;
  deleteSession: (sessionId: string) => Promise<void>;
}

// stores/upload-store.ts
interface UploadState {
  uploadProgress: Record<string, number>;
  uploadedFiles: UploadedFile[];

  // Actions
  uploadFile: (file: File, scenario_id: string) => Promise<void>;
  getProgress: (fileId: string) => number;
}
```

### 7.3 API å®¢æˆ·ç«¯

```typescript
// lib/api-v2.ts
export const api = {
  // é—®ç­”
  async askQuestion(params: QuestionRequest): Promise<QuestionResponse> {
    return axios.post('/api/v2/chat/ask', params);
  },

  // ä¼šè¯ç®¡ç†
  async getSessions(scenario_id?: string): Promise<ChatSession[]> {
    return axios.get('/api/v2/chat/sessions', { params: { scenario_id } });
  },

  async createSession(data: CreateSessionRequest): Promise<ChatSession> {
    return axios.post('/api/v2/chat/sessions', data);
  },

  // æ–‡æ¡£ä¸Šä¼ 
  async uploadFile(file: File, scenario_id: string): Promise<Document> {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('scenario_id', scenario_id);
    return axios.post('/api/v2/upload', formData);
  },

  // åœºæ™¯ç®¡ç†
  async getScenarios(): Promise<Scenario[]> {
    return axios.get('/api/v2/scenarios/');
  },

  // çŸ¥è¯†åº“
  async getKnowledge(category?: string): Promise<KnowledgeItem[]> {
    return axios.get('/api/v2/knowledge/', { params: { category } });
  }
};
```

---

## 8. åç«¯æ¶æ„

### 8.1 æœåŠ¡å±‚è®¾è®¡

**ScenarioService (åœºæ™¯æœåŠ¡):**
```python
class ScenarioService:
    """åœºæ™¯ç®¡ç†æœåŠ¡"""

    def get_all_scenarios(self) -> List[Dict]:
        """è·å–æ‰€æœ‰åœºæ™¯"""
        with self.db() as db:
            scenarios = db.query(Scenario).filter(
                Scenario.status == "active"
            ).all()
            return [self._serialize(s) for s in scenarios]

    def get_scenario(self, scenario_id: str) -> Optional[Dict]:
        """è·å–ç‰¹å®šåœºæ™¯"""
        with self.db() as db:
            scenario = db.query(Scenario).filter(
                Scenario.id == scenario_id
            ).first()
            return self._serialize(scenario) if scenario else None

    def validate_scenario(self, scenario_id: str) -> bool:
        """éªŒè¯åœºæ™¯æ˜¯å¦å­˜åœ¨"""
        return self.get_scenario(scenario_id) is not None
```

**DocumentService (æ–‡æ¡£æœåŠ¡):**
```python
class DocumentService:
    """æ–‡æ¡£ç®¡ç†æœåŠ¡"""

    def process_document(self, file_path: str, scenario_id: str) -> str:
        """å¤„ç†æ–‡æ¡£"""
        # 1. åˆ›å»ºæ–‡æ¡£è®°å½•
        doc_id = self.create_document_record(file_path, scenario_id)

        # 2. è°ƒç”¨ Pipeline å¤„ç†
        pipeline = Pipeline(
            root_path=settings.data_dir,
            scenario_id=scenario_id
        )
        pipeline.prepare_documents()

        # 3. æ›´æ–°çŠ¶æ€
        self.update_document_status(doc_id, "completed")

        return doc_id

    def get_documents(self, scenario_id: str) -> List[Dict]:
        """è·å–æ–‡æ¡£åˆ—è¡¨"""
        with self.db() as db:
            docs = db.query(Document).filter(
                Document.scenario_id == scenario_id
            ).all()
            return [self._serialize(d) for d in docs]
```

### 8.2 API è·¯ç”±è®¾è®¡

**Chat API:**
```python
@router.post("/ask", response_model=QuestionResponse)
async def ask_question(
    request: QuestionRequest,
    current_user: dict = Depends(get_current_user),
    tenant_id: str = Depends(get_current_tenant)
):
    """å¤šåœºæ™¯æ™ºèƒ½é—®ç­”"""
    # 1. éªŒè¯åœºæ™¯
    if not scenario_service.validate_scenario(request.scenario_id):
        raise HTTPException(400, "æ— æ•ˆåœºæ™¯")

    # 2. åˆ›å»º/è·å–ä¼šè¯
    if not request.session_id:
        session = await create_session({
            "scenario_id": request.scenario_id,
            "title": request.question[:30]
        })
        request.session_id = session.id

    # 3. è°ƒç”¨ Pipeline å¤„ç†
    pipeline = Pipeline(
        root_path=settings.data_dir,
        scenario_id=request.scenario_id,
        tenant_id=tenant_id
    )
    result = pipeline.answer_question(
        question=request.question,
        company=request.company
    )

    # 4. ä¿å­˜æ¶ˆæ¯
    save_messages(request.session_id, request.question, result['answer'])

    return QuestionResponse(
        success=True,
        answer=result['answer'],
        confidence=result['confidence'],
        sources=result.get('sources', [])
    )
```

### 8.3 è®¤è¯ä¸­é—´ä»¶

```python
# middleware/auth_middleware.py
async def get_current_user(
    token: str = Depends(oauth2_scheme)
) -> dict:
    """è·å–å½“å‰ç”¨æˆ·"""
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        username = payload.get("sub")
        if not username:
            raise HTTPException(401, "æ— æ•ˆå‡­è¯")
        return {"username": username, "user_id": payload.get("user_id")}
    except JWTError:
        raise HTTPException(401, "æ— æ•ˆå‡­è¯")

async def get_current_tenant(
    current_user: dict = Depends(get_current_user)
) -> str:
    """è·å–å½“å‰ç§Ÿæˆ·ID"""
    # ä»ç”¨æˆ·ä¿¡æ¯ä¸­æå–ç§Ÿæˆ·ID
    with get_db_session() as db:
        user = db.query(User).filter(
            User.username == current_user['username']
        ).first()
        return user.tenant_id if user else "default"
```

---

## 9. éƒ¨ç½²ä¸è¿ç»´

### 9.1 å¯åŠ¨æ–¹å¼

**å¿«é€Ÿå¯åŠ¨:**
```bash
# ä¸€é”®å¯åŠ¨ç³»ç»Ÿï¼ˆå‰åç«¯ï¼‰
python start_system.py

# æˆ–åˆ†åˆ«å¯åŠ¨
python run_backend.py   # åç«¯ (ç«¯å£ 8000)
python run_frontend.py  # å‰ç«¯ (ç«¯å£ 3005)
```

**ç³»ç»Ÿå¯åŠ¨æµç¨‹:**
```python
# start_system.py
class SystemManager:
    def start_system(self):
        # 1. ç¯å¢ƒæ£€æŸ¥
        self.check_environment()

        # 2. å®‰è£…ä¾èµ–
        self.install_dependencies()

        # 3. åˆå§‹åŒ–æ•°æ®åº“
        self.initialize_database()

        # 4. å¯åŠ¨åç«¯æœåŠ¡
        self.start_backend()

        # 5. å¯åŠ¨å‰ç«¯æœåŠ¡
        self.start_frontend()

        # 6. ç›‘æ§æœåŠ¡çŠ¶æ€
        self.monitor_services()
```

### 9.2 ç¯å¢ƒé…ç½®

**.env é…ç½®:**
```env
# DashScope API
DASHSCOPE_API_KEY=your_api_key_here

# æ•°æ®åº“
DATABASE_URL=sqlite:///./data/stock_data/databases/stock_rag.db

# JWT è®¤è¯
SECRET_KEY=your_secret_key_here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# æ–‡ä»¶å­˜å‚¨
DATA_DIR=data/stock_data
UPLOAD_DIR=data/uploads

# æ—¥å¿—
LOG_LEVEL=INFO
```

### 9.3 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®é™…å€¼ | è¯´æ˜ |
|------|--------|--------|------|
| API å“åº”æ—¶é—´ | < 3ç§’ | 2-5ç§’ | åŒ…å«æ£€ç´¢å’Œç”Ÿæˆ |
| æ–‡æ¡£è§£æé€Ÿåº¦ | ~2MB/åˆ†é’Ÿ | 1-3MB/åˆ†é’Ÿ | å–å†³äºæ–‡æ¡£å¤æ‚åº¦ |
| æ£€ç´¢ç²¾åº¦ | > 85% | 85-92% | Top-5 å‡†ç¡®ç‡ |
| å¹¶å‘ç”¨æˆ· | 50+ | 100+ | å·²æµ‹è¯• |
| å†…å­˜å ç”¨ | < 4GB | 2-4GB | åŒ…å«ç´¢å¼• |

---

## 10. å¼€å‘æŒ‡å—

### 10.1 æœ¬åœ°å¼€å‘ç¯å¢ƒ

**ç³»ç»Ÿè¦æ±‚:**
- Python 3.10+
- Node.js 18+
- 8GB+ å†…å­˜
- 10GB+ å¯ç”¨ç£ç›˜ç©ºé—´

**å®‰è£…æ­¥éª¤:**
```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd stock-rag-system

# 2. åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# 4. å®‰è£…å‰ç«¯ä¾èµ–
cd frontend-next
npm install
cd ..

# 5. é…ç½®ç¯å¢ƒå˜é‡
cp config_template.env .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ DASHSCOPE_API_KEY

# 6. åˆå§‹åŒ–æ•°æ®åº“
python -c "from backend.database import init_database; init_database()"

# 7. å¯åŠ¨ç³»ç»Ÿ
python start_system.py
```

### 10.2 å¼€å‘è§„èŒƒ

**åç«¯å¼€å‘:**
- ä½¿ç”¨ç»å¯¹å¯¼å…¥ï¼Œé¿å…ç›¸å¯¹å¯¼å…¥
- API è·¯ç”±ä½¿ç”¨ `/api/v2/` å‰ç¼€
- ä½¿ç”¨ Pydantic æ¨¡å‹å®šä¹‰è¯·æ±‚å’Œå“åº”
- ç¡®ä¿ `scenario_id` å’Œ `tenant_id` æ­£ç¡®ä¼ é€’
- ä½¿ç”¨ logger è€Œé print è¯­å¥

**å‰ç«¯å¼€å‘:**
- ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼
- ç»„ä»¶å•ä¸€èŒè´£åŸåˆ™
- åŠ¨æ€ UI ä» `useScenario()` è·å–
- ä½¿ç”¨ Tailwind CSS utility classes
- API è°ƒç”¨ç»Ÿä¸€ä½¿ç”¨ `lib/api-v2.ts`

### 10.3 è°ƒè¯•æŠ€å·§

**åç«¯è°ƒè¯•:**
```python
# å¯ç”¨è¯¦ç»†æ—¥å¿—
import logging
logging.basicConfig(level=logging.DEBUG)

# æŸ¥çœ‹ SQL æŸ¥è¯¢
engine = create_engine(DATABASE_URL, echo=True)

# æµ‹è¯• API ç«¯ç‚¹
# è®¿é—® http://localhost:8000/docs
```

**å‰ç«¯è°ƒè¯•:**
```typescript
// æŸ¥çœ‹çŠ¶æ€å˜åŒ–
const { state } = useScenario();
console.log('Current scenario:', state.currentScenario);

// æŸ¥çœ‹ API å“åº”
axios.interceptors.response.use(
  response => {
    console.log('API Response:', response.data);
    return response;
  }
);
```

### 10.4 æµ‹è¯•

**è¿è¡Œæµ‹è¯•:**
```bash
# åç«¯æµ‹è¯•
pytest tests/

# å‰ç«¯æµ‹è¯•
cd frontend-next
npm run test
```

---

## é™„å½•

### A. å…³é”®æ–‡ä»¶ç´¢å¼•

**æ ¸å¿ƒæ–‡ä»¶:**
- `start_system.py` - ç³»ç»Ÿå¯åŠ¨å…¥å£
- `src/pipeline.py` - RAG ä¸»æµç¨‹
- `src/questions_processing.py` - é—®ç­”å¤„ç†å™¨
- `backend/main_multi_scenario.py` - åç«¯ä¸»å…¥å£
- `frontend-next/app/page.tsx` - å‰ç«¯é¦–é¡µ

**é…ç½®æ–‡ä»¶:**
- `.env` - ç¯å¢ƒå˜é‡é…ç½®
- `requirements.txt` - Python ä¾èµ–
- `frontend-next/package.json` - å‰ç«¯ä¾èµ–

**æ–‡æ¡£:**
- `docs/æ‹›æŠ•æ ‡AIç³»ç»Ÿæ¶æ„è®¾è®¡.md` - æ¶æ„è®¾è®¡
- `docs/Agentic_RAGå®Œæ•´å®ç°æŒ‡å—.md` - RAG å®ç°æŒ‡å—
- `docs/æ‹›æŠ•æ ‡AIç³»ç»Ÿå¼€å‘ä»»åŠ¡æ¸…å•.md` - ä»»åŠ¡æ¸…å•

### B. å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨ç³»ç»Ÿ
python start_system.py

# åç«¯å¼€å‘
uvicorn backend.main_multi_scenario:app --reload --port 8000

# å‰ç«¯å¼€å‘
cd frontend-next && npm run dev

# æ•°æ®åº“è¿ç§»
alembic upgrade head

# è¿è¡Œæµ‹è¯•
pytest tests/ -v

# ä»£ç æ ¼å¼åŒ–
black backend/ src/
prettier --write "frontend-next/**/*.{ts,tsx}"
```

### C. æ•…éšœæ’æŸ¥

**å¸¸è§é—®é¢˜:**

1. **API Key é”™è¯¯**
   - æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `DASHSCOPE_API_KEY`
   - ç¡®ä¿ API Key æœ‰æ•ˆä¸”æœ‰ä½™é¢

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ `DATABASE_URL` é…ç½®
   - ç¡®ä¿æ•°æ®åº“æ–‡ä»¶è·¯å¾„å­˜åœ¨

3. **å‘é‡æ£€ç´¢å¤±è´¥**
   - æ£€æŸ¥ FAISS ç´¢å¼•æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   - è¿è¡Œ `pipeline.prepare_documents()` é‡å»ºç´¢å¼•

4. **å‰ç«¯è¿æ¥å¤±è´¥**
   - æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨ (http://localhost:8000/health)
   - æ£€æŸ¥ CORS é…ç½®

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2025å¹´1æœˆ
**ç»´æŠ¤è€…ï¼š** é¡¹ç›®å¼€å‘å›¢é˜Ÿ

**ç›¸å…³æ–‡æ¡£ï¼š**
- [æ¶æ„è®¾è®¡æ–‡æ¡£](./æ‹›æŠ•æ ‡AIç³»ç»Ÿæ¶æ„è®¾è®¡.md)
- [Agentic RAG å®ç°æŒ‡å—](./Agentic_RAGå®Œæ•´å®ç°æŒ‡å—.md)
- [å¼€å‘ä»»åŠ¡æ¸…å•](./æ‹›æŠ•æ ‡AIç³»ç»Ÿå¼€å‘ä»»åŠ¡æ¸…å•.md)

